<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
<title>Spoty</title>

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;900&family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
:root{
  --bg:#060608;--s1:#0f0f14;--s2:#18181f;--s3:#22222c;
  --bd:rgba(255,255,255,0.08);--bd2:rgba(255,255,255,0.04);
  --a1:#a78bff;--a2:#ff5f8f;--a3:#00e5a0;--a4:#ffd060;
  --tx:#f2f2ff;--mu:#60607a;--mu2:#9898b8;
  --gr:linear-gradient(135deg,#a78bff,#ff5f8f);
  --sh:0 20px 60px rgba(0,0,0,0.8);
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{height:100%;}
body{
  background:var(--bg);color:var(--tx);
  font-family:'Noto Sans JP','Outfit',sans-serif;
  overflow:hidden;position:fixed;width:100%;
}
button{cursor:pointer;font-family:inherit;}
::-webkit-scrollbar{display:none;}

/* AUTH */
#authWrap{
  position:fixed;inset:0;z-index:999;background:var(--bg);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:24px;overflow-y:auto;
}
.auth-logo-block{text-align:center;margin-bottom:40px;}
.auth-pin{font-size:4rem;display:block;margin-bottom:8px;}
.auth-wordmark{
  font-family:'Outfit',sans-serif;font-size:3.2rem;font-weight:900;letter-spacing:-0.05em;
  background:var(--gr);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.auth-tagline{font-size:0.82rem;color:var(--mu2);margin-top:6px;letter-spacing:0.06em;}
.auth-card{background:var(--s1);border:1px solid var(--bd);border-radius:28px;width:100%;max-width:420px;padding:30px 24px;}
.auth-segs{display:flex;background:var(--s2);border-radius:16px;padding:4px;margin-bottom:24px;gap:4px;}
.auth-seg{flex:1;padding:11px;border:none;background:none;font-size:0.88rem;font-weight:700;color:var(--mu);border-radius:12px;transition:all 0.22s;}
.auth-seg.on{background:var(--gr);color:#fff;}
.ae{display:none;background:rgba(255,95,143,0.1);border:1px solid rgba(255,95,143,0.3);border-radius:12px;padding:10px 14px;font-size:0.8rem;color:var(--a2);margin-bottom:12px;}
.fg{margin-bottom:14px;}
.fl{display:block;font-size:0.66rem;font-weight:700;color:var(--mu);letter-spacing:0.15em;text-transform:uppercase;margin-bottom:6px;}
.fi{width:100%;background:var(--s2);border:1px solid var(--bd);border-radius:13px;padding:13px 15px;color:var(--tx);font-size:0.9rem;outline:none;-webkit-appearance:none;}
.fi:focus{border-color:var(--a1);}
.fi::placeholder{color:var(--mu);}
.auth-btn{width:100%;background:var(--gr);border:none;border-radius:14px;padding:15px;font-size:0.95rem;font-weight:900;color:#fff;margin-top:6px;}
.demo-note{text-align:center;margin-top:14px;font-size:0.73rem;color:var(--mu);line-height:1.7;}

/* APP SHELL */
#app{display:none;position:fixed;inset:0;flex-direction:column;}
.topbar{
  flex-shrink:0;height:52px;
  display:flex;align-items:center;padding:0 14px;gap:10px;
  background:linear-gradient(to bottom,rgba(6,6,8,0.95),rgba(6,6,8,0.0));
  position:absolute;top:0;left:0;right:0;z-index:200;
}
.tb-logo{font-family:'Outfit',sans-serif;font-size:1.4rem;font-weight:900;letter-spacing:-0.04em;background:var(--gr);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;cursor:pointer;flex-shrink:0;}
.tb-search{flex:1;display:flex;align-items:center;gap:6px;background:rgba(255,255,255,0.08);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.1);border-radius:20px;padding:0 12px;height:34px;}
.tb-search input{flex:1;background:none;border:none;outline:none;color:var(--tx);font-size:0.8rem;min-width:0;}
.tb-search input::placeholder{color:var(--mu2);}
.tb-search button{background:none;border:none;color:var(--a1);font-size:0.9rem;}
.tb-av{width:32px;height:32px;border-radius:50%;flex-shrink:0;overflow:hidden;background:var(--gr);display:flex;align-items:center;justify-content:center;font-size:0.82rem;font-weight:900;color:#fff;cursor:pointer;border:2px solid rgba(255,255,255,0.2);}
.tb-av img{width:100%;height:100%;object-fit:cover;}

.screens{position:absolute;inset:0;overflow:hidden;}
.screen{position:absolute;inset:0;display:none;flex-direction:column;overflow:hidden;}
.screen.on{display:flex;}
#feedScreen{background:var(--bg);}
#vertFeed{position:absolute;inset:52px 0 64px 0;overflow-y:scroll;-webkit-overflow-scrolling:touch;padding:16px;}
.card{
  background:var(--s1);border:1px solid var(--bd);border-radius:16px;
  padding:14px;margin-bottom:12px;
}
.card h3{font-size:1rem;margin-bottom:6px;}
.card .meta{color:var(--mu2);font-size:0.78rem;margin-bottom:10px;}
.card .desc{color:rgba(242,242,255,0.82);font-size:0.88rem;line-height:1.6;}

#mapScreen{background:var(--bg);}
#theMap{position:absolute;top:52px;bottom:64px;left:0;right:0;}
#savedScreen{background:var(--bg);padding-top:52px;padding-bottom:64px;overflow:auto;}
#savedGrid{padding:16px;}
#mypageScreen{background:var(--bg);padding-top:52px;padding-bottom:64px;overflow:auto;}
#mypageInner{padding:16px;}

.bottomnav{
  position:absolute;bottom:0;left:0;right:0;z-index:300;
  background:rgba(6,6,8,0.97);backdrop-filter:blur(20px);
  border-top:1px solid var(--bd);
  display:flex;align-items:center;
  padding:6px 0 max(6px,env(safe-area-inset-bottom));
  height:64px;
}
.bn-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;cursor:pointer;color:var(--mu);transition:color 0.2s;}
.bn-item.on{color:#fff;}
.bn-icon{font-size:1.3rem;line-height:1;}
.bn-label{font-size:0.56rem;font-weight:700;letter-spacing:0.04em;}
.bn-post{
  width:50px;height:50px;border-radius:14px;background:var(--gr);
  display:flex;align-items:center;justify-content:center;
  font-size:1.6rem;cursor:pointer;flex-shrink:0;margin-top:-14px;
  box-shadow:0 0 20px rgba(167,139,255,0.5),0 0 40px rgba(255,95,143,0.3);
}

.toast{
  position:fixed;bottom:76px;left:50%;transform:translateX(-50%) translateY(20px);
  background:rgba(30,30,40,0.95);backdrop-filter:blur(20px);
  border:1px solid var(--bd);border-radius:14px;
  padding:11px 20px;font-size:0.82rem;font-weight:600;z-index:1500;
  opacity:0;pointer-events:none;transition:all 0.25s;white-space:nowrap;
  box-shadow:0 8px 32px rgba(0,0,0,0.6);
}
.toast.on{opacity:1;transform:translateX(-50%) translateY(0);}
</style>

<!-- Firebase (Firestoreã ã‘) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAr674Ds7ns-iKjTx4UPaN09hlo_LNu2rI",
    authDomain: "spoty-64d44.firebaseapp.com",
    projectId: "spoty-64d44",
    storageBucket: "spoty-64d44.firebasestorage.app",
    messagingSenderId: "337557449917",
    appId: "1:337557449917:web:40d383e007402e4d469bd4",
    measurementId: "G-PF7NFMQX3S"
  };
  firebase.initializeApp(firebaseConfig);
  window.db = firebase.firestore();
</script>

</head>
<body>

<!-- â•â•â•â• AUTH â•â•â•â• -->
<div id="authWrap">
  <div class="auth-logo-block">
    <span class="auth-pin">ğŸ“</span>
    <div class="auth-wordmark">Spoty</div>
    <div class="auth-tagline">æ—…ã€ã‚‚ã£ã¨è‡ªç”±ã«ã€‚ã‚ãªãŸã ã‘ã®ã‚¹ãƒãƒƒãƒˆã‚’ã€‚</div>
  </div>

  <div class="auth-card">
    <div class="auth-segs">
      <button class="auth-seg on" onclick="authSeg('login',this)">ãƒ­ã‚°ã‚¤ãƒ³</button>
      <button class="auth-seg" onclick="authSeg('reg',this)">æ–°è¦ç™»éŒ²</button>
    </div>

    <div id="ae" class="ae"></div>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ -->
    <div id="loginF">
      <div class="fg">
        <label class="fl">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
        <input class="fi" id="lEm" type="email" placeholder="example@email.com" inputmode="email">
      </div>
      <div class="fg">
        <label class="fl">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
        <input class="fi" id="lPw" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')doLogin()">
      </div>
      <button class="auth-btn" onclick="doLogin()">ãƒ­ã‚°ã‚¤ãƒ³ â†’</button>
      <div class="demo-note">ãƒ‡ãƒ¢ç”¨: test@spoty.jp / password123</div>
    </div>

    <!-- æ–°è¦ç™»éŒ² -->
    <div id="regF" style="display:none;">
      <div class="fg"><label class="fl">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </label><input class="fi" id="rNm" type="text" placeholder="ä¾‹ï¼šæ—…å¥½ãå¤ªéƒ"></div>
      <div class="fg"><label class="fl">ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆè‹±æ•°å­—ãƒ»_ï¼‰</label><input class="fi" id="rId" type="text" placeholder="tabi_taro" oninput="this.value=this.value.replace(/[^a-zA-Z0-9_]/g,'').toLowerCase()"></div>
      <div class="fg"><label class="fl">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label><input class="fi" id="rEm" type="email" placeholder="example@email.com" inputmode="email"></div>
      <div class="fg"><label class="fl">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ8æ–‡å­—ä»¥ä¸Šï¼‰</label><input class="fi" id="rPw" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')doReg()"></div>
      <button class="auth-btn" onclick="doReg()">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ â†’</button>
    </div>
  </div>
</div>

<!-- â•â•â•â• APP â•â•â•â• -->
<div id="app">
  <!-- Top bar -->
  <div class="topbar">
    <div class="tb-logo" onclick="gotoFeed()">ğŸ“ Spoty</div>
    <div class="tb-search">
      <span style="color:var(--mu2);font-size:0.85rem;">ğŸ”</span>
      <input id="srchIn" type="text" placeholder="æ¤œç´¢ï¼ˆä¾‹ï¼šæ±äº¬ è‡ªç„¶ï¼‰..." onkeydown="if(event.key==='Enter')doSearch()">
      <button onclick="doSearch()">â†’</button>
    </div>
    <div class="tb-av" id="topAv" onclick="switchSc('mypage')"></div>
  </div>

  <div class="screens">
    <div class="screen on" id="feedScreen">
      <div id="vertFeed"></div>
    </div>

    <div class="screen" id="mapScreen">
      <div id="theMap"></div>
    </div>

    <div class="screen" id="savedScreen">
      <div id="savedGrid"></div>
    </div>

    <div class="screen" id="mypageScreen">
      <div id="mypageInner"></div>
    </div>
  </div>

  <!-- Bottom Nav -->
  <nav class="bottomnav">
    <div class="bn-item on" id="bn-feed" onclick="switchSc('feed')"><span class="bn-icon">ğŸ </span><span class="bn-label">ãƒ›ãƒ¼ãƒ </span></div>
    <div class="bn-item" id="bn-map" onclick="switchSc('map')"><span class="bn-icon">ğŸ—ºï¸</span><span class="bn-label">ãƒãƒƒãƒ—</span></div>
    <div class="bn-post" onclick="openPostStub()">ï¼‹</div>
    <div class="bn-item" id="bn-saved" onclick="switchSc('saved')"><span class="bn-icon">ğŸ”–</span><span class="bn-label">ä¿å­˜</span></div>
    <div class="bn-item" id="bn-mypage" onclick="switchSc('mypage')"><span class="bn-icon">ğŸ‘¤</span><span class="bn-label">ãƒã‚¤ãƒšãƒ¼ã‚¸</span></div>
  </nav>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
/* â•â• STATE â•â• */
let posts=[], users={}, cu=null;
let srch='';
let mapInst=null;

const sv=(k,v)=>{try{localStorage.setItem('sp4_'+k,JSON.stringify(v));}catch(e){}};
const ld=(k,d)=>{try{const v=localStorage.getItem('sp4_'+k);return v?JSON.parse(v):d;}catch(e){return d;}};

/* â•â• TOAST â•â• */
let toastT;
function toast(m){
  const t=document.getElementById('toast');
  t.textContent=m;
  t.classList.add('on');
  clearTimeout(toastT);
  toastT=setTimeout(()=>t.classList.remove('on'),2200);
}

/* â•â• AUTH â•â• */
function authSeg(t,el){
  document.querySelectorAll('.auth-seg').forEach(x=>x.classList.remove('on'));
  el.classList.add('on');
  document.getElementById('loginF').style.display = (t==='login') ? 'block' : 'none';
  document.getElementById('regF').style.display   = (t==='reg')   ? 'block' : 'none';
  document.getElementById('ae').style.display='none';
}
function authErr(m){
  const e=document.getElementById('ae');
  e.textContent=m;
  e.style.display='block';
}
function doLogin(){
  const em=document.getElementById('lEm').value.trim().toLowerCase();
  const pw=document.getElementById('lPw').value;
  if(!em||!pw) return authErr('å…¥åŠ›ã—ã¦ãã ã•ã„');

  const u=users[em];
  if(!u || u.pass!==pw) return authErr('ãƒ¡ãƒ¼ãƒ«ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™');

  cu={email:em,...u};
  sv('sess',em);
  launch();
}
function doReg(){
  const nm=document.getElementById('rNm').value.trim();
  const uid=document.getElementById('rId').value.trim();
  const em=document.getElementById('rEm').value.trim().toLowerCase();
  const pw=document.getElementById('rPw').value;

  if(!nm||!uid||!em||!pw) return authErr('ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„');
  if(pw.length<8) return authErr('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Š');

  if(users[em]) return authErr('ã“ã®ãƒ¡ãƒ¼ãƒ«ã¯ã™ã§ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™');
  if(Object.values(users).some(u=>u.uid===uid)) return authErr('ã“ã®IDã¯ã™ã§ã«ä½¿ã‚ã‚Œã¦ã„ã¾ã™');

  users[em]={name:nm,uid,pass:pw,av:null,following:[],createdAt:Date.now()};
  sv('users',users);

  cu={email:em,...users[em]};
  sv('sess',em);
  launch();
}
function doLogout(){
  sv('sess',null);
  cu=null;
  document.getElementById('app').style.display='none';
  document.getElementById('authWrap').style.display='flex';
  toast('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ');
}
function launch(){
  document.getElementById('authWrap').style.display='none';
  document.getElementById('app').style.display='flex';
  updTopAv();
  renderFeed();
  switchSc('feed');
}

/* â•â• TOP AVATAR â•â• */
function updTopAv(){
  const el=document.getElementById('topAv');
  if(!cu){ el.textContent='?'; return; }
  el.textContent = (cu.name||'?').charAt(0).toUpperCase();
}

/* â•â• SCREEN SWITCHING â•â• */
const scMap={feed:'feedScreen',map:'mapScreen',saved:'savedScreen',mypage:'mypageScreen'};
const bnMap={feed:'bn-feed',map:'bn-map',saved:'bn-saved',mypage:'bn-mypage'};
function switchSc(s){
  Object.entries(scMap).forEach(([k,id])=>{
    const el=document.getElementById(id);
    el.classList.remove('on');
    el.style.display='none';
  });
  const on=document.getElementById(scMap[s]);
  on.style.display='flex';
  on.classList.add('on');

  document.querySelectorAll('.bn-item').forEach(x=>x.classList.remove('on'));
  const bn=document.getElementById(bnMap[s]); if(bn) bn.classList.add('on');

  if(s==='map') initMap();
  if(s==='saved') renderSaved();
  if(s==='mypage') renderMypage();
}
function gotoFeed(){switchSc('feed');}

/* â•â• SEARCH â•â• */
function doSearch(){
  srch=(document.getElementById('srchIn').value||'').trim().toLowerCase();
  renderFeed();
}
function renderFeed(){
  const list = (srch)
    ? posts.filter(p => (p.title+' '+p.pref+' '+p.cat+' '+p.desc).toLowerCase().includes(srch))
    : posts.slice();

  const vf=document.getElementById('vertFeed');
  if(!list.length){
    vf.innerHTML = `<div class="card"><h3>æŠ•ç¨¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</h3><div class="meta">æ¤œç´¢æ¡ä»¶ã‚’å¤‰ãˆã¦ã¿ã¦ã­</div></div>`;
    return;
  }
  vf.innerHTML = list.map(p=>`
    <div class="card">
      <h3>${escapeHtml(p.title)}</h3>
      <div class="meta">ğŸ“ ${escapeHtml(p.pref)} Â· ${escapeHtml(p.cat)} Â· by @${escapeHtml(p.uid)}</div>
      <div class="desc">${escapeHtml(p.desc)}</div>
    </div>
  `).join('');
}

/* â•â• MAP â•â• */
function initMap(){
  if(!mapInst){
    mapInst = L.map('theMap').setView([36.2048,138.2529],6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
      attribution:'Â© OpenStreetMap',maxZoom:18
    }).addTo(mapInst);
  }
  // pins
  posts.filter(p=>p.lat&&p.lng).forEach(p=>{
    L.marker([p.lat,p.lng]).addTo(mapInst).bindPopup(`<b>${escapeHtml(p.title)}</b><br>${escapeHtml(p.pref)} Â· ${escapeHtml(p.cat)}`);
  });
  setTimeout(()=>mapInst.invalidateSize(),200);
}

/* â•â• SAVED / MYPAGE (ç°¡æ˜“) â•â• */
function renderSaved(){
  const el=document.getElementById('savedGrid');
  el.innerHTML = `<div class="card"><h3>ä¿å­˜æ©Ÿèƒ½ã¯ã“ã®ç°¡æ˜“ç‰ˆã§ã¯æœªå®Ÿè£…</h3><div class="meta">æ¬¡ã«å®Ÿè£…ã—ã‚ˆã†</div></div>`;
}
function renderMypage(){
  const el=document.getElementById('mypageInner');
  if(!cu){ el.innerHTML=''; return; }
  el.innerHTML = `
    <div class="card">
      <h3>${escapeHtml(cu.name)} (@${escapeHtml(cu.uid)})</h3>
      <div class="meta">${escapeHtml(cu.email)}</div>
      <button class="auth-btn" onclick="doLogout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>
  `;
}

/* â•â• POST BUTTON STUB â•â• */
function openPostStub(){
  toast('æŠ•ç¨¿æ©Ÿèƒ½ã¯æ¬¡ã«æ¥ç¶šã—ã¾ã™ï¼ˆã¾ãšãƒ­ã‚°ã‚¤ãƒ³/æ–°è¦ç™»éŒ²ã‚’å®‰å®šåŒ–ï¼‰');
}

/* â•â• INIT â•â• */
function seedPosts(){
  return [
    {id:'ps1',title:'è‰åƒé‡Œãƒ¶æµœ',pref:'ç†Šæœ¬çœŒ',cat:'è‡ªç„¶',desc:'é˜¿è˜‡ã®çµ¶æ™¯ã‚¹ãƒãƒƒãƒˆã€‚æœæ—©ã„æ™‚é–“ãŒæœ€é«˜ï¼',uid:'aso_tabi',lat:32.8873,lng:131.0826},
    {id:'ps2',title:'ç­‰ã€…åŠ›æ¸“è°·',pref:'æ±äº¬éƒ½',cat:'è‡ªç„¶',desc:'æ±äº¬23åŒºå†…ã®è‡ªç„¶ã€‚æ•£ç­–ãŒæ°—æŒã¡ã„ã„ï¼',uid:'tokyo_hidden',lat:35.6178,lng:139.6577},
    {id:'ps3',title:'å·å´å·¥å ´å¤œæ™¯',pref:'ç¥å¥ˆå·çœŒ',cat:'å¤œæ™¯',desc:'SFã¿ãŸã„ãªå¤œæ™¯ãŒè¦‹ã‚Œã‚‹ã€‚ãƒ‡ãƒ¼ãƒˆã«ãŠã™ã™ã‚ã€‚',uid:'night_view',lat:35.5322,lng:139.7033},
  ];
}
function init(){
  posts = ld('posts', seedPosts());
  users = ld('users', {
    'test@spoty.jp': {name:'ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼',uid:'test_user',pass:'password123',av:null,following:[],createdAt:Date.now()}
  });

  // Firestoreï¼ˆèª­ã¿è¾¼ã¿ã ã‘ï¼‰â€»æ¥ç¶šã§ããªã„å ´åˆã‚‚è½ã¡ãªã„
  try{
    if(window.db){
      window.db.collection("posts").orderBy("createdAt","desc").onSnapshot((snap)=>{
        // ã“ã“ã§ã¯ç°¡æ˜“ç‰ˆãªã®ã§ã€FirestoreãŒç©ºã§ã‚‚è½ã¨ã•ãªã„
        // å°†æ¥ï¼šã“ã“ã§ posts ã‚’ä¸Šæ›¸ãã—ã¦ renderFeed() ã™ã‚Œã°OK
      });
    }
  }catch(e){ console.warn(e); }

  const sess = ld('sess', null);
  if(sess && users[sess]){
    cu = {email:sess, ...users[sess]};
    launch();
  }else{
    document.getElementById('authWrap').style.display='flex';
    document.getElementById('app').style.display='none';
  }

  sv('posts', posts);
  sv('users', users);
}

/* â•â• SAFETY â•â• */
function escapeHtml(s){
  return String(s??'').replace(/[&<>"']/g,(c)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]));
}

init();
</script>

</body>
</html>
































